<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>å•è¯æœ¬</title>
  <style>
    /* è®¾ç½®å…¨å±€å­—ä½“ã€èƒŒæ™¯å’Œé—´è· */
    body { font-family: sans-serif; margin: 2em; background: #f6f6f6; }

    /* è¾“å…¥æ¡†å’ŒæŒ‰é’®çš„åŸºç¡€æ ·å¼ */
    input, button { font-size: 16px; padding: 0.5em; margin: 0.25em; }

    /* å¡ç‰‡å®¹å™¨æ ·å¼ */
    .card {
      background: #fff;
      border: 1px solid #ccc;
      padding: 1em;
      margin-top: 1em;
      border-radius: 8px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }

    /* å•è¯è¡Œæ ·å¼ï¼ˆå·¦ä¾§å•è¯ï¼Œå³ä¾§å‘éŸ³æŒ‰é’®ï¼‰ */
    .word-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* å•è¯å­—ä½“å¤§å° */
    .word-row h2 {
      margin: 0;
      font-size: 20px;
    }

    /* éŸ³æ ‡æ ·å¼ï¼ˆç°è‰²å°å­—ï¼‰ */
    .phonetic {
      color: #888;
      font-size: 14px;
      margin: 0.2em 0 0.6em;
    }

    /* æ®µè½é—´è· */
    .card p {
      margin: 0.4em 0;
    }

    /* ç¼–è¾‘ä¸åˆ é™¤æŒ‰é’®æ ·å¼ */
    .actions button {
      margin-right: 0.5em;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <h1>ğŸ“˜ å•è¯æœ¬</h1> <!-- é¡µé¢æ ‡é¢˜ -->

  <!-- æ·»åŠ å•è¯åŒºåŸŸ -->
  <div>
    <input id="word" placeholder="è‹±æ–‡å•è¯"> <!-- è‹±æ–‡è¾“å…¥æ¡† -->
    <input id="meaning" placeholder="ä¸­æ–‡é‡Šä¹‰"> <!-- ä¸­æ–‡é‡Šä¹‰è¾“å…¥æ¡† -->
    <button onclick="handleAdd()">æ·»åŠ åˆ°å•è¯æœ¬</button> <!-- æ·»åŠ æŒ‰é’® -->
  </div>

  <!-- å•è¯åˆ—è¡¨åŒºåŸŸ -->
  <div id="word-list"></div>

  <script>
    // åˆå§‹åŒ–å…¨å±€å•è¯æ•°ç»„ï¼Œä» localStorage ä¸­è¯»å–å·²æœ‰æ•°æ®
    let words = JSON.parse(localStorage.getItem('myWords')) || [];

    // å¤„ç†â€œæ·»åŠ â€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    async function handleAdd() {
      const text = document.getElementById('word').value.trim();     // è·å–è‹±æ–‡å•è¯
      const meaning = document.getElementById('meaning').value.trim(); // è·å–ä¸­æ–‡é‡Šä¹‰

      if (!text || !meaning) return alert('è¯·è¾“å…¥å®Œæ•´å†…å®¹'); // æ£€æŸ¥æ˜¯å¦è¾“å…¥å®Œæ•´

      const wordData = await fetchWordData(text); // è°ƒç”¨ API è·å–éŸ³æ ‡å’ŒéŸ³é¢‘
      if (!wordData) return alert('æœªæ‰¾åˆ°éŸ³æ ‡æ•°æ®'); // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæç¤ºé”™è¯¯

      // åˆ›å»ºæ–°çš„å•è¯å¯¹è±¡
      const entry = {
        text,
        meaning,
        phonetic: wordData.phonetic,
        audio: wordData.audio
      };

      words.push(entry); // æ·»åŠ åˆ°æ•°ç»„
      localStorage.setItem('myWords', JSON.stringify(words)); // å­˜å…¥æµè§ˆå™¨æœ¬åœ°å­˜å‚¨
      renderWords(); // é‡æ–°æ¸²æŸ“é¡µé¢
      document.getElementById('word').value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
      document.getElementById('meaning').value = '';
    }

    // è°ƒç”¨ dictionaryapi è·å–å•è¯éŸ³æ ‡å’Œå‘éŸ³
    async function fetchWordData(word) {
      try {
        const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        const data = await res.json();

        // å°è¯•è·å–éŸ³æ ‡å­—æ®µï¼ˆæœ‰äº› API è¿”å›çš„æ ¼å¼ä¸åŒï¼‰
        const phonetic = data[0].phonetic || (data[0].phonetics[0] || {}).text || '';

        // å°è¯•è·å–ç¬¬ä¸€ä¸ªå¸¦éŸ³é¢‘çš„å­—æ®µ
        const audio = (data[0].phonetics.find(p => p.audio) || {}).audio;

        // è¿”å›å¤„ç†å¥½çš„æ•°æ®ï¼ˆè¡¥å…¨httpså‰ç¼€ï¼‰
        return {
          phonetic,
          audio: audio?.startsWith('//') ? 'https:' + audio : audio
        };
      } catch {
        return null; // å‘ç”Ÿé”™è¯¯æ—¶è¿”å› null
      }
    }

    // æ¸²æŸ“å•è¯å¡ç‰‡åˆ—è¡¨
    function renderWords() {
      const list = document.getElementById('word-list'); // è·å–å±•ç¤ºåŒºåŸŸ
      list.innerHTML = ''; // æ¸…ç©ºåŸæœ‰å†…å®¹

      words.forEach((w, i) => {
        const div = document.createElement('div'); // åˆ›å»ºä¸€ä¸ª div å…ƒç´ 
        div.className = 'card'; // åº”ç”¨æ ·å¼ç±»å

        // æ‹¼æ¥ HTML ç»“æ„ï¼ŒåŒ…å«éŸ³æ ‡ã€é‡Šä¹‰ã€å‘éŸ³æŒ‰é’®ã€ç¼–è¾‘åˆ é™¤æŒ‰é’®
        div.innerHTML = `
          <div class="word-row">
            <h2>${w.text}</h2>
            ${w.audio ? `
              <button onclick="document.getElementById('audio-${i}').play()">ğŸ”Š</button>
              <audio id="audio-${i}" src="${w.audio}"></audio>
            ` : ''}
          </div>
          <div class="phonetic">${w.phonetic || ''}</div>
          <p>é‡Šä¹‰ï¼š<span id="meaning-${i}">${w.meaning}</span></p>
          <div class="actions">
            <button onclick="editMeaning(${i})">ç¼–è¾‘</button>
            <button onclick="deleteWord(${i})">åˆ é™¤</button>
          </div>
        `;
        list.appendChild(div); // æ·»åŠ åˆ°é¡µé¢ä¸­
      });
    }

    // åˆ é™¤æŸä¸ªå•è¯
    function deleteWord(index) {
      if (!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•è¯å—ï¼Ÿ")) return; // äºŒæ¬¡ç¡®è®¤
      words.splice(index, 1); // ä»æ•°ç»„ä¸­ç§»é™¤
      localStorage.setItem('myWords', JSON.stringify(words)); // ä¿å­˜æ›´æ–°
      renderWords(); // é‡æ–°æ¸²æŸ“
    }

    // ç¼–è¾‘é‡Šä¹‰
    function editMeaning(index) {
      const newMeaning = prompt("è¯·è¾“å…¥æ–°çš„é‡Šä¹‰ï¼š", words[index].meaning); // å¼¹å‡ºè¾“å…¥æ¡†
      if (newMeaning) {
        words[index].meaning = newMeaning.trim(); // ä¿®æ”¹é‡Šä¹‰
        localStorage.setItem('myWords', JSON.stringify(words)); // ä¿å­˜åˆ°æœ¬åœ°
        renderWords(); // åˆ·æ–°æ˜¾ç¤º
      }
    }

    renderWords(); // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¸²æŸ“å·²æœ‰å•è¯
  </script>
</body>
</html>
